<navigation-bar title="香氛疗愈" back="true"></navigation-bar>
<view class="page-content">
  <!-- 当前状态 -->
  <view class="status-card">
    <view class="status-header">
      <van-icon name="flower-o" size="40px" color="#8b5cf6" />
      <view class="status-info">
        <view class="status-title">香氛疗愈系统</view>
        <view class="status-desc">超声波雾化，智能扩散</view>
      </view>
      <van-tag type="{{isRunning ? 'success' : 'default'}}" size="large">
        {{isRunning ? '运行中' : '已停止'}}
      </van-tag>
    </view>
  </view>

  <!-- 香氛盒管理 -->
  <view class="config-card">
    <view class="section-title">香氛盒管理</view>
    <van-cell-group>
      <van-cell wx:for="{{aromaBoxes}}" wx:key="id" 
                title="香氛仓{{item.id}}" 
                label="{{item.name}} - 剩余{{item.remaining}}次"
                is-link 
                bind:tap="selectAromaBox" 
                data-box="{{item}}">
        <van-icon wx:if="{{selectedBoxId === item.id}}" name="success" color="#07c160" />
        <van-tag wx:if="{{item.remaining < 5}}" type="warning" size="small">低库存</van-tag>
      </van-cell>
      <van-cell title="RFID识别" value="{{rfidEnabled ? '开启' : '关闭'}}">
        <van-switch checked="{{rfidEnabled}}" bind:change="onRfidChange" />
      </van-cell>
    </van-cell-group>
  </view>

  <!-- 扩散控制 -->
  <view class="config-card">
    <view class="section-title">扩散控制</view>
    <van-cell-group>
      <van-cell title="雾化技术" value="超声波雾化" />
      <van-cell title="扩散模式" is-link bind:tap="selectDiffusionMode">
        <text>{{diffusionMode}}</text>
      </van-cell>
      <van-cell title="浓度调节">
        <van-slider 
          min="1" 
          max="5" 
          value="{{concentration}}" 
          show-value 
          bind:change="onConcentrationChange"
          active-color="#8b5cf6"
        />
      </van-cell>
      <van-cell title="定时释放" is-link bind:tap="selectReleaseMode">
        <text>{{releaseMode}}</text>
      </van-cell>
    </van-cell-group>
  </view>

  <!-- 香氛配方 -->
  <view class="config-card">
    <view class="section-title">香氛配方</view>
    <van-cell-group>
      <van-cell title="当前配方" is-link bind:tap="selectAromaFormula">
        <text>{{currentFormula.name}}</text>
      </van-cell>
      <van-cell title="配方描述" label="{{currentFormula.description}}" />
      <van-cell title="适用场景" label="{{currentFormula.scenario}}" />
      <van-cell title="持续时间" value="{{currentFormula.duration}}分钟" />
    </van-cell-group>
  </view>

  <!-- 定时设置 -->
  <view class="config-card">
    <view class="section-title">定时设置</view>
    <van-cell-group>
      <van-cell title="定时开启" value="{{timerEnabled ? '开启' : '关闭'}}">
        <van-switch checked="{{timerEnabled}}" bind:change="onTimerChange" />
      </van-cell>
      <van-cell wx:if="{{timerEnabled}}" title="开始时间" is-link bind:tap="selectStartTime">
        <text>{{startTime}}</text>
      </van-cell>
      <van-cell wx:if="{{timerEnabled}}" title="结束时间" is-link bind:tap="selectEndTime">
        <text>{{endTime}}</text>
      </van-cell>
      <van-cell title="剩余时间" value="{{remainingTime}}" />
    </van-cell-group>
  </view>

  <!-- 控制按钮 -->
  <view class="control-buttons">
    <van-button 
      type="{{isRunning ? 'danger' : 'primary'}}" 
      size="large" 
      block 
      bind:tap="toggleAromatherapy"
      loading="{{loading}}"
    >
      {{isRunning ? '停止香氛' : '启动香氛'}}
    </van-button>
  </view>
</view> 
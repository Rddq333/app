<navigation-bar title="香氛理疗" back="true"></navigation-bar>
<view class="page-content">
<!-- 当前状态 -->
<view class="status-card">
    <view class="status-header">
      <van-icon name="flower-o" size="40px" color="#8b5cf6" />
      <view class="status-info">
        <view class="status-title">香氛理疗系统</view>
        <view class="status-desc">智能扩散，情境疗愈</view>
      </view>
      <van-tag type="{{isRunning ? 'success' : 'default'}}" size="large">
        {{isRunning ? '运行中' : '已停止'}}
      </van-tag>
    </view>
  </view>

  <!-- 设备状态提示 -->
  <view class="device-status" wx:if="{{!isRunning}}">
    <van-cell-group>
      <van-cell title="设备状态" value="{{deviceStatus}}" />
      <van-cell title="连接状态" value="{{deviceConnected ? '已连接' : '未连接'}}" />
    </van-cell-group>
  </view>

  <!-- 基础香氛参数 -->
  <view class="config-card">
    <view class="section-title">基础香氛参数</view>
    <van-cell-group>
      <!-- 香氛类型选择 -->
      <van-cell title="香氛类型">
        <picker mode="selector" range="{{aromaTypes}}" value="{{aromaTypeIndex}}" bindchange="onAromaTypeChange">
          <view class="picker-value">{{selectedAromaType}}</view>
        </picker>
      </van-cell>
      
      <!-- 浓度调节 -->
      <van-cell title="浓度等级">
        <view class="concentration-control">
          <van-slider 
            min="1" 
            max="5" 
            value="{{concentration}}" 
            show-value 
            bind:change="onConcentrationChange"
            active-color="#8b5cf6"
          />
          <view class="concentration-info">
            <text>{{concentration}}级 ({{concentration * 0.5}}%挥发油浓度)</text>
          </view>
        </view>
      </van-cell>
      
      <!-- 扩散方式 -->
      <van-cell title="扩散方式">
        <picker mode="selector" range="{{diffusionModes}}" value="{{diffusionModeIndex}}" bindchange="onDiffusionModeChange">
          <view class="picker-value">{{diffusionMode}}</view>
        </picker>
      </van-cell>
      
      <!-- 持续时间 -->
      <van-cell title="持续时间">
        <picker mode="selector" range="{{durationOptions}}" value="{{durationIndex}}" bindchange="onDurationChange">
          <view class="picker-value">{{duration}}分钟</view>
        </picker>
      </van-cell>
    </van-cell-group>
  </view>

  <!-- 情境模式参数 -->
  <view class="config-card">
    <view class="section-title">情境模式参数</view>
    <van-cell-group>
      <!-- 情境模式选择 -->
      <van-cell title="情境模式">
        <picker mode="selector" range="{{scenarioOptions}}" value="{{scenarioIndex}}" bindchange="onScenarioChange">
          <view class="picker-value">{{selectedScenario}}</view>
        </picker>
      </van-cell>
      
      <!-- 推荐香型 -->
      <van-cell wx:if="{{selectedScenario !== '自定义'}}" title="推荐香型" label="{{scenarioConfig.recommendedAroma}}" />
      
      <!-- 推荐浓度 -->
      <van-cell wx:if="{{selectedScenario !== '自定义'}}" title="推荐浓度" label="{{scenarioConfig.recommendedConcentration}}级" />
      
      <!-- 扩散节奏 -->
      <van-cell wx:if="{{selectedScenario !== '自定义'}}" title="扩散节奏" label="{{scenarioConfig.diffusionRhythm}}" />
      
      <!-- 灯光配合 -->
      <van-cell wx:if="{{selectedScenario !== '自定义'}}" title="灯光配合" label="{{scenarioConfig.lightMode}}" />
    </van-cell-group>
  </view>

  <!-- 高级设置 -->
<view class="config-card">
  <view class="section-title">高级设置</view>
  <van-cell-group>
    <!-- 自动调节 -->
    <van-cell title="自动浓度调节">
      <picker mode="selector" range="{{['关闭','开启']}}" value="{{autoAdjust ? 1 : 0}}" bindchange="onAutoAdjustChange">
        <view class="picker-value">{{autoAdjust ? '开启' : '关闭'}}</view>
      </picker>
    </van-cell>
    <!-- 智能间歇 -->
    <van-cell title="智能间歇模式">
      <picker mode="selector" range="{{['关闭','开启']}}" value="{{smartInterval ? 1 : 0}}" bindchange="onSmartIntervalChange">
        <view class="picker-value">{{smartInterval ? '开启' : '关闭'}}</view>
      </picker>
    </van-cell>
    <!-- 环境监测 -->
    <van-cell title="环境监测">
      <picker mode="selector" range="{{['关闭','开启']}}" value="{{environmentMonitor ? 1 : 0}}" bindchange="onEnvironmentMonitorChange">
        <view class="picker-value">{{environmentMonitor ? '开启' : '关闭'}}</view>
      </picker>
    </van-cell>
  </van-cell-group>
</view>
  <!-- 运行信息 -->
  <view class="config-card" wx:if="{{isRunning}}">
    <view class="section-title">运行信息</view>
    <van-cell-group>
      <van-cell title="运行时间" value="{{runningTime}}" />
      <van-cell title="剩余时间" value="{{remainingTime}}" />
      <van-cell title="当前浓度" value="{{currentConcentration}}级" />
      <van-cell title="扩散状态" value="{{diffusionStatus}}" />
    </van-cell-group>
  </view>

  <!-- 控制按钮 -->
  <view class="control-buttons">
    <van-button 
      type="{{isRunning ? (isPaused ? 'primary' : 'warning') : 'primary'}}" 
      size="large" 
      block 
      bind:tap="toggleAromatherapy"
      loading="{{loading}}"
    >
      {{isRunning ? (isPaused ? '继续' : '暂停') : '启动'}}
    </van-button>
    
    <van-button 
      wx:if="{{isRunning}}" 
      type="danger" 
      size="large" 
      block 
      bind:tap="stopAromatherapy"
      style="margin-top: 10px;"
    >
      结束
    </van-button>
  </view>
</view> 
<navigation-bar title="药浴理疗" back="true"></navigation-bar>
<view class="status-card">
  <view class="status-header">
    <van-icon name="leaf" size="40px" color="#34d399" />
    <view class="status-info">
      <view class="status-title">药浴理疗系统</view>
      <view class="status-desc">草本浸泡，调和身心</view>
    </view>
    <van-tag type="{{status === 'running' ? 'success' : 'default'}}" size="large">
      {{status === 'running' ? '运行中' : '已停止'}}
    </van-tag>
  </view>
</view>
<!-- 设备状态提示 -->
<view class="device-status" wx:if="{{!isRunning}}">
  <van-cell-group>
    <van-cell title="设备状态" value="{{deviceStatus}}" />
    <van-cell title="连接状态" value="{{deviceConnected ? '已连接' : '未连接'}}" />
  </van-cell-group>
</view>
<view class="herbal-bath-container">
  <view class="section-title">基础治疗参数</view>
  <!-- 药液浓度 -->
  <view class="param-row">
    <text class="param-label">药液浓度</text>
    <picker mode="selector" range="{{params.concentrationOptions}}" value="{{concentrationIndex}}" bindchange="onConcentrationChange">
      <view class="picker-value">1:{{params.concentration}}</view>
    </picker>
  </view>
  <!-- 水温 -->
  <view class="param-row">
    <text class="param-label">水温</text>
    <slider min="38" max="42" step="0.5" value="{{params.waterTemp}}" bindchange="onWaterTempChange" show-value />
    <view class="quick-btns">
      <button wx:for="{{params.waterTempQuick}}" wx:key="item" size="mini" class="quick-btn" data-value="{{item}}" bindtap="onQuickTemp">{{item}}℃</button>
    </view>
    <text class="param-value">{{params.waterTemp}}℃</text>
  </view>
  <!-- 浸泡时间 -->
  <view class="param-row">
    <text class="param-label">浸泡时间</text>
    <picker mode="selector" range="{{params.soakTimeOptions}}" value="{{soakTimeIndex}}" bindchange="onSoakTimeChange">
      <view class="picker-value">{{params.soakTime}}分钟</view>
    </picker>
  </view>
  <!-- 水流强度 -->
  <view class="param-row">
    <text class="param-label">水流强度</text>
    <radio-group bindchange="onFlowStrengthChange">
      <label wx:for="{{params.flowStrengthOptions}}" wx:key="item">
        <radio value="{{item}}" checked="{{params.flowStrength === item}}" />{{item}}
      </label>
    </radio-group>
  </view>

  <view class="section-title">药材配方参数</view>
  <!-- 药材类型 -->
  <view class="param-row">
    <text class="param-label">药材类型</text>
    <picker mode="selector" range="{{params.herbTypeOptions}}" value="{{herbTypeIndex}}" bindchange="onHerbTypeChange">
      <view class="picker-value">{{params.herbType}}</view>
    </picker>
  </view>
  <!-- 药材形态 -->
  <view class="param-row">
    <text class="param-label">药材形态</text>
    <picker mode="selector" range="{{params.herbFormOptions}}" value="{{herbFormIndex}}" bindchange="onHerbFormChange">
      <view class="picker-value">{{params.herbForm}}</view>
    </picker>
  </view>
  <!-- 药材剂量 -->
  <view class="param-row">
    <text class="param-label">药材剂量</text>
    <picker mode="selector" range="{{params.herbDoseOptions}}" range-key="label" value="{{herbDoseIndex}}" bindchange="onHerbDoseChange">
      <view class="picker-value">{{params.herbDoseOptions[herbDoseIndex].label}}</view>
    </picker>
  </view>

  <view class="config-card" wx:if="{{isRunning}}">
    <view class="section-title">运行信息</view>
    <van-cell-group>
      <van-cell title="运行时间" value="{{runningTime}}" />
      <van-cell title="剩余时间" value="{{remainingTime}}" />
      <van-cell title="当前浓度" value="{{params.concentration}}" />
      <van-cell title="当前水温" value="{{params.waterTemp}}℃" />
      <van-cell title="当前状态" value="{{status === 'running' ? '运行中' : (status === 'paused' ? '已暂停' : '已停止')}}" />
    </van-cell-group>
  </view>
  <view class="control-buttons">
    <van-button 
      type="{{isRunning ? (isPaused ? 'primary' : 'warning') : 'primary'}}" 
      size="large" 
      block 
      custom-class="round-btn"
      bind:tap="onToggle"
      loading="{{loading}}"
    >
      {{isRunning ? (isPaused ? '继续' : '暂停') : '启动'}}
    </van-button>
    <van-button 
      wx:if="{{isRunning}}" 
      type="danger" 
      size="large" 
      block 
      custom-class="round-btn"
      bind:tap="onStop"
      style="margin-top: 10px;"
    >
      结束
    </van-button>
  </view>
</view> 